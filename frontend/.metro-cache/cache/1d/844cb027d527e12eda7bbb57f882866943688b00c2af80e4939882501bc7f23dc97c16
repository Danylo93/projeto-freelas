{"dependencies":[{"name":"@babel/runtime/helpers/interopRequireDefault","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"kslwqCIsh6ew+I1KeA1rlVRjsAk=","exportNames":["*"]}},{"name":"@babel/runtime/helpers/classCallCheck","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"yg7e6laZwmpbIvId5jovq9ugXp8=","exportNames":["*"]}},{"name":"@babel/runtime/helpers/createClass","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"Z6pzkVZ2fvxBLkFTgVVOy4UDj30=","exportNames":["*"]}},{"name":"@babel/runtime/helpers/possibleConstructorReturn","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"aU3Lrys8xTVpYSDJal2nhppojC8=","exportNames":["*"]}},{"name":"@babel/runtime/helpers/getPrototypeOf","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"4DwyfFXBA53CJWVTVj5w3kH1PUg=","exportNames":["*"]}},{"name":"@babel/runtime/helpers/inherits","data":{"asyncType":null,"isESMImport":false,"locs":[],"key":"y0uNg4LxF1CLscQChxzgo5dfjvA=","exportNames":["*"]}},{"name":"../transport.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":1,"column":0,"index":0},"end":{"line":1,"column":44,"index":44}}],"key":"q68AWRvh2qc0QUlp41HSOL9aMUA=","exportNames":["*"]}},{"name":"../globals.node.js","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":2,"column":0,"index":45},"end":{"line":2,"column":46,"index":91}}],"key":"RPWURBgga4vfm2ZRigByneogh6w=","exportNames":["*"]}},{"name":"engine.io-parser","data":{"asyncType":null,"isESMImport":true,"locs":[{"start":{"line":3,"column":0,"index":92},"end":{"line":3,"column":89,"index":181}}],"key":"IB5HY76c7xC+tDEPCV8b/nK76DU=","exportNames":["*"]}}],"output":[{"data":{"code":"__d(function (global, require, _$$_IMPORT_DEFAULT, _$$_IMPORT_ALL, module, exports, _dependencyMap) {\n  var _interopRequireDefault = require(_dependencyMap[0], \"@babel/runtime/helpers/interopRequireDefault\");\n  Object.defineProperty(exports, \"__esModule\", {\n    value: true\n  });\n  exports.WT = void 0;\n  var _classCallCheck2 = _interopRequireDefault(require(_dependencyMap[1], \"@babel/runtime/helpers/classCallCheck\"));\n  var _createClass2 = _interopRequireDefault(require(_dependencyMap[2], \"@babel/runtime/helpers/createClass\"));\n  var _possibleConstructorReturn2 = _interopRequireDefault(require(_dependencyMap[3], \"@babel/runtime/helpers/possibleConstructorReturn\"));\n  var _getPrototypeOf2 = _interopRequireDefault(require(_dependencyMap[4], \"@babel/runtime/helpers/getPrototypeOf\"));\n  var _inherits2 = _interopRequireDefault(require(_dependencyMap[5], \"@babel/runtime/helpers/inherits\"));\n  var _transport = require(_dependencyMap[6], \"../transport.js\");\n  var _globalsNode = require(_dependencyMap[7], \"../globals.node.js\");\n  var _engine = require(_dependencyMap[8], \"engine.io-parser\");\n  function _callSuper(t, o, e) { return o = (0, _getPrototypeOf2.default)(o), (0, _possibleConstructorReturn2.default)(t, _isNativeReflectConstruct() ? Reflect.construct(o, e || [], (0, _getPrototypeOf2.default)(t).constructor) : o.apply(t, e)); }\n  function _isNativeReflectConstruct() { try { var t = !Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); } catch (t) {} return (_isNativeReflectConstruct = function () { return !!t; })(); }\n  /**\n   * WebTransport transport based on the built-in `WebTransport` object.\n   *\n   * Usage: browser, Node.js (with the `@fails-components/webtransport` package)\n   *\n   * @see https://developer.mozilla.org/en-US/docs/Web/API/WebTransport\n   * @see https://caniuse.com/webtransport\n   */\n  var WT = exports.WT = /*#__PURE__*/function (_Transport) {\n    function WT() {\n      (0, _classCallCheck2.default)(this, WT);\n      return _callSuper(this, WT, arguments);\n    }\n    (0, _inherits2.default)(WT, _Transport);\n    return (0, _createClass2.default)(WT, [{\n      key: \"name\",\n      get: function () {\n        return \"webtransport\";\n      }\n    }, {\n      key: \"doOpen\",\n      value: function doOpen() {\n        try {\n          // @ts-ignore\n          this._transport = new WebTransport(this.createUri(\"https\"), this.opts.transportOptions[this.name]);\n        } catch (err) {\n          return this.emitReserved(\"error\", err);\n        }\n        this._transport.closed.then(() => {\n          this.onClose();\n        }).catch(err => {\n          this.onError(\"webtransport error\", err);\n        });\n        // note: we could have used async/await, but that would require some additional polyfills\n        this._transport.ready.then(() => {\n          this._transport.createBidirectionalStream().then(stream => {\n            var decoderStream = (0, _engine.createPacketDecoderStream)(Number.MAX_SAFE_INTEGER, this.socket.binaryType);\n            var reader = stream.readable.pipeThrough(decoderStream).getReader();\n            var encoderStream = (0, _engine.createPacketEncoderStream)();\n            encoderStream.readable.pipeTo(stream.writable);\n            this._writer = encoderStream.writable.getWriter();\n            var read = () => {\n              reader.read().then(_ref => {\n                var done = _ref.done,\n                  value = _ref.value;\n                if (done) {\n                  return;\n                }\n                this.onPacket(value);\n                read();\n              }).catch(err => {});\n            };\n            read();\n            var packet = {\n              type: \"open\"\n            };\n            if (this.query.sid) {\n              packet.data = `{\"sid\":\"${this.query.sid}\"}`;\n            }\n            this._writer.write(packet).then(() => this.onOpen());\n          });\n        });\n      }\n    }, {\n      key: \"write\",\n      value: function write(packets) {\n        var _this = this;\n        this.writable = false;\n        var _loop = function () {\n          var packet = packets[i];\n          var lastPacket = i === packets.length - 1;\n          _this._writer.write(packet).then(() => {\n            if (lastPacket) {\n              (0, _globalsNode.nextTick)(() => {\n                _this.writable = true;\n                _this.emitReserved(\"drain\");\n              }, _this.setTimeoutFn);\n            }\n          });\n        };\n        for (var i = 0; i < packets.length; i++) {\n          _loop();\n        }\n      }\n    }, {\n      key: \"doClose\",\n      value: function doClose() {\n        var _a;\n        (_a = this._transport) === null || _a === void 0 ? void 0 : _a.close();\n      }\n    }]);\n  }(_transport.Transport);\n});","lineCount":109,"map":[[12,2,1,0],[12,6,1,0,"_transport"],[12,16,1,0],[12,19,1,0,"require"],[12,26,1,0],[12,27,1,0,"_dependencyMap"],[12,41,1,0],[13,2,2,0],[13,6,2,0,"_globalsNode"],[13,18,2,0],[13,21,2,0,"require"],[13,28,2,0],[13,29,2,0,"_dependencyMap"],[13,43,2,0],[14,2,3,0],[14,6,3,0,"_engine"],[14,13,3,0],[14,16,3,0,"require"],[14,23,3,0],[14,24,3,0,"_dependencyMap"],[14,38,3,0],[15,2,3,89],[15,11,3,89,"_callSuper"],[15,22,3,89,"t"],[15,23,3,89],[15,25,3,89,"o"],[15,26,3,89],[15,28,3,89,"e"],[15,29,3,89],[15,40,3,89,"o"],[15,41,3,89],[15,48,3,89,"_getPrototypeOf2"],[15,64,3,89],[15,65,3,89,"default"],[15,72,3,89],[15,74,3,89,"o"],[15,75,3,89],[15,82,3,89,"_possibleConstructorReturn2"],[15,109,3,89],[15,110,3,89,"default"],[15,117,3,89],[15,119,3,89,"t"],[15,120,3,89],[15,122,3,89,"_isNativeReflectConstruct"],[15,147,3,89],[15,152,3,89,"Reflect"],[15,159,3,89],[15,160,3,89,"construct"],[15,169,3,89],[15,170,3,89,"o"],[15,171,3,89],[15,173,3,89,"e"],[15,174,3,89],[15,186,3,89,"_getPrototypeOf2"],[15,202,3,89],[15,203,3,89,"default"],[15,210,3,89],[15,212,3,89,"t"],[15,213,3,89],[15,215,3,89,"constructor"],[15,226,3,89],[15,230,3,89,"o"],[15,231,3,89],[15,232,3,89,"apply"],[15,237,3,89],[15,238,3,89,"t"],[15,239,3,89],[15,241,3,89,"e"],[15,242,3,89],[16,2,3,89],[16,11,3,89,"_isNativeReflectConstruct"],[16,37,3,89],[16,51,3,89,"t"],[16,52,3,89],[16,56,3,89,"Boolean"],[16,63,3,89],[16,64,3,89,"prototype"],[16,73,3,89],[16,74,3,89,"valueOf"],[16,81,3,89],[16,82,3,89,"call"],[16,86,3,89],[16,87,3,89,"Reflect"],[16,94,3,89],[16,95,3,89,"construct"],[16,104,3,89],[16,105,3,89,"Boolean"],[16,112,3,89],[16,145,3,89,"t"],[16,146,3,89],[16,159,3,89,"_isNativeReflectConstruct"],[16,184,3,89],[16,196,3,89,"_isNativeReflectConstruct"],[16,197,3,89],[16,210,3,89,"t"],[16,211,3,89],[17,2,4,0],[18,0,5,0],[19,0,6,0],[20,0,7,0],[21,0,8,0],[22,0,9,0],[23,0,10,0],[24,0,11,0],[25,2,4,0],[25,6,12,13,"WT"],[25,8,12,15],[25,11,12,15,"exports"],[25,18,12,15],[25,19,12,15,"WT"],[25,21,12,15],[25,47,12,15,"_Transport"],[25,57,12,15],[26,4,12,15],[26,13,12,15,"WT"],[26,16,12,15],[27,6,12,15],[27,10,12,15,"_classCallCheck2"],[27,26,12,15],[27,27,12,15,"default"],[27,34,12,15],[27,42,12,15,"WT"],[27,44,12,15],[28,6,12,15],[28,13,12,15,"_callSuper"],[28,23,12,15],[28,30,12,15,"WT"],[28,32,12,15],[28,34,12,15,"arguments"],[28,43,12,15],[29,4,12,15],[30,4,12,15],[30,8,12,15,"_inherits2"],[30,18,12,15],[30,19,12,15,"default"],[30,26,12,15],[30,28,12,15,"WT"],[30,30,12,15],[30,32,12,15,"_Transport"],[30,42,12,15],[31,4,12,15],[31,15,12,15,"_createClass2"],[31,28,12,15],[31,29,12,15,"default"],[31,36,12,15],[31,38,12,15,"WT"],[31,40,12,15],[32,6,12,15,"key"],[32,9,12,15],[33,6,12,15,"get"],[33,9,12,15],[33,11,13,4],[33,20,13,4,"get"],[33,21,13,4],[33,23,13,15],[34,8,14,8],[34,15,14,15],[34,29,14,29],[35,6,15,4],[36,4,15,5],[37,6,15,5,"key"],[37,9,15,5],[38,6,15,5,"value"],[38,11,15,5],[38,13,16,4],[38,22,16,4,"doOpen"],[38,28,16,10,"doOpen"],[38,29,16,10],[38,31,16,13],[39,8,17,8],[39,12,17,12],[40,10,18,12],[41,10,19,12],[41,14,19,16],[41,15,19,17,"_transport"],[41,25,19,27],[41,28,19,30],[41,32,19,34,"WebTransport"],[41,44,19,46],[41,45,19,47],[41,49,19,51],[41,50,19,52,"createUri"],[41,59,19,61],[41,60,19,62],[41,67,19,69],[41,68,19,70],[41,70,19,72],[41,74,19,76],[41,75,19,77,"opts"],[41,79,19,81],[41,80,19,82,"transportOptions"],[41,96,19,98],[41,97,19,99],[41,101,19,103],[41,102,19,104,"name"],[41,106,19,108],[41,107,19,109],[41,108,19,110],[42,8,20,8],[42,9,20,9],[42,10,21,8],[42,17,21,15,"err"],[42,20,21,18],[42,22,21,20],[43,10,22,12],[43,17,22,19],[43,21,22,23],[43,22,22,24,"emitReserved"],[43,34,22,36],[43,35,22,37],[43,42,22,44],[43,44,22,46,"err"],[43,47,22,49],[43,48,22,50],[44,8,23,8],[45,8,24,8],[45,12,24,12],[45,13,24,13,"_transport"],[45,23,24,23],[45,24,24,24,"closed"],[45,30,24,30],[45,31,25,13,"then"],[45,35,25,17],[45,36,25,18],[45,42,25,24],[46,10,26,12],[46,14,26,16],[46,15,26,17,"onClose"],[46,22,26,24],[46,23,26,25],[46,24,26,26],[47,8,27,8],[47,9,27,9],[47,10,27,10],[47,11,28,13,"catch"],[47,16,28,18],[47,17,28,20,"err"],[47,20,28,23],[47,24,28,28],[48,10,29,12],[48,14,29,16],[48,15,29,17,"onError"],[48,22,29,24],[48,23,29,25],[48,43,29,45],[48,45,29,47,"err"],[48,48,29,50],[48,49,29,51],[49,8,30,8],[49,9,30,9],[49,10,30,10],[50,8,31,8],[51,8,32,8],[51,12,32,12],[51,13,32,13,"_transport"],[51,23,32,23],[51,24,32,24,"ready"],[51,29,32,29],[51,30,32,30,"then"],[51,34,32,34],[51,35,32,35],[51,41,32,41],[52,10,33,12],[52,14,33,16],[52,15,33,17,"_transport"],[52,25,33,27],[52,26,33,28,"createBidirectionalStream"],[52,51,33,53],[52,52,33,54],[52,53,33,55],[52,54,33,56,"then"],[52,58,33,60],[52,59,33,62,"stream"],[52,65,33,68],[52,69,33,73],[53,12,34,16],[53,16,34,22,"decoderStream"],[53,29,34,35],[53,32,34,38],[53,36,34,38,"createPacketDecoderStream"],[53,69,34,63],[53,71,34,64,"Number"],[53,77,34,70],[53,78,34,71,"MAX_SAFE_INTEGER"],[53,94,34,87],[53,96,34,89],[53,100,34,93],[53,101,34,94,"socket"],[53,107,34,100],[53,108,34,101,"binaryType"],[53,118,34,111],[53,119,34,112],[54,12,35,16],[54,16,35,22,"reader"],[54,22,35,28],[54,25,35,31,"stream"],[54,31,35,37],[54,32,35,38,"readable"],[54,40,35,46],[54,41,35,47,"pipeThrough"],[54,52,35,58],[54,53,35,59,"decoderStream"],[54,66,35,72],[54,67,35,73],[54,68,35,74,"getReader"],[54,77,35,83],[54,78,35,84],[54,79,35,85],[55,12,36,16],[55,16,36,22,"encoderStream"],[55,29,36,35],[55,32,36,38],[55,36,36,38,"createPacketEncoderStream"],[55,69,36,63],[55,71,36,64],[55,72,36,65],[56,12,37,16,"encoderStream"],[56,25,37,29],[56,26,37,30,"readable"],[56,34,37,38],[56,35,37,39,"pipeTo"],[56,41,37,45],[56,42,37,46,"stream"],[56,48,37,52],[56,49,37,53,"writable"],[56,57,37,61],[56,58,37,62],[57,12,38,16],[57,16,38,20],[57,17,38,21,"_writer"],[57,24,38,28],[57,27,38,31,"encoderStream"],[57,40,38,44],[57,41,38,45,"writable"],[57,49,38,53],[57,50,38,54,"getWriter"],[57,59,38,63],[57,60,38,64],[57,61,38,65],[58,12,39,16],[58,16,39,22,"read"],[58,20,39,26],[58,23,39,29,"read"],[58,24,39,29],[58,29,39,35],[59,14,40,20,"reader"],[59,20,40,26],[59,21,41,25,"read"],[59,25,41,29],[59,26,41,30],[59,27,41,31],[59,28,42,25,"then"],[59,32,42,29],[59,33,42,30,"_ref"],[59,37,42,30],[59,41,42,51],[60,16,42,51],[60,20,42,33,"done"],[60,24,42,37],[60,27,42,37,"_ref"],[60,31,42,37],[60,32,42,33,"done"],[60,36,42,37],[61,18,42,39,"value"],[61,23,42,44],[61,26,42,44,"_ref"],[61,30,42,44],[61,31,42,39,"value"],[61,36,42,44],[62,16,43,24],[62,20,43,28,"done"],[62,24,43,32],[62,26,43,34],[63,18,44,28],[64,16,45,24],[65,16,46,24],[65,20,46,28],[65,21,46,29,"onPacket"],[65,29,46,37],[65,30,46,38,"value"],[65,35,46,43],[65,36,46,44],[66,16,47,24,"read"],[66,20,47,28],[66,21,47,29],[66,22,47,30],[67,14,48,20],[67,15,48,21],[67,16,48,22],[67,17,49,25,"catch"],[67,22,49,30],[67,23,49,32,"err"],[67,26,49,35],[67,30,49,40],[67,31,50,20],[67,32,50,21],[67,33,50,22],[68,12,51,16],[68,13,51,17],[69,12,52,16,"read"],[69,16,52,20],[69,17,52,21],[69,18,52,22],[70,12,53,16],[70,16,53,22,"packet"],[70,22,53,28],[70,25,53,31],[71,14,53,33,"type"],[71,18,53,37],[71,20,53,39],[72,12,53,46],[72,13,53,47],[73,12,54,16],[73,16,54,20],[73,20,54,24],[73,21,54,25,"query"],[73,26,54,30],[73,27,54,31,"sid"],[73,30,54,34],[73,32,54,36],[74,14,55,20,"packet"],[74,20,55,26],[74,21,55,27,"data"],[74,25,55,31],[74,28,55,34],[74,39,55,45],[74,43,55,49],[74,44,55,50,"query"],[74,49,55,55],[74,50,55,56,"sid"],[74,53,55,59],[74,57,55,63],[75,12,56,16],[76,12,57,16],[76,16,57,20],[76,17,57,21,"_writer"],[76,24,57,28],[76,25,57,29,"write"],[76,30,57,34],[76,31,57,35,"packet"],[76,37,57,41],[76,38,57,42],[76,39,57,43,"then"],[76,43,57,47],[76,44,57,48],[76,50,57,54],[76,54,57,58],[76,55,57,59,"onOpen"],[76,61,57,65],[76,62,57,66],[76,63,57,67],[76,64,57,68],[77,10,58,12],[77,11,58,13],[77,12,58,14],[78,8,59,8],[78,9,59,9],[78,10,59,10],[79,6,60,4],[80,4,60,5],[81,6,60,5,"key"],[81,9,60,5],[82,6,60,5,"value"],[82,11,60,5],[82,13,61,4],[82,22,61,4,"write"],[82,27,61,9,"write"],[82,28,61,10,"packets"],[82,35,61,17],[82,37,61,19],[83,8,61,19],[83,12,61,19,"_this"],[83,17,61,19],[84,8,62,8],[84,12,62,12],[84,13,62,13,"writable"],[84,21,62,21],[84,24,62,24],[84,29,62,29],[85,8,62,30],[85,12,62,30,"_loop"],[85,17,62,30],[85,29,62,30,"_loop"],[85,30,62,30],[85,32,63,49],[86,10,64,12],[86,14,64,18,"packet"],[86,20,64,24],[86,23,64,27,"packets"],[86,30,64,34],[86,31,64,35,"i"],[86,32,64,36],[86,33,64,37],[87,10,65,12],[87,14,65,18,"lastPacket"],[87,24,65,28],[87,27,65,31,"i"],[87,28,65,32],[87,33,65,37,"packets"],[87,40,65,44],[87,41,65,45,"length"],[87,47,65,51],[87,50,65,54],[87,51,65,55],[88,10,66,12,"_this"],[88,15,66,16],[88,16,66,17,"_writer"],[88,23,66,24],[88,24,66,25,"write"],[88,29,66,30],[88,30,66,31,"packet"],[88,36,66,37],[88,37,66,38],[88,38,66,39,"then"],[88,42,66,43],[88,43,66,44],[88,49,66,50],[89,12,67,16],[89,16,67,20,"lastPacket"],[89,26,67,30],[89,28,67,32],[90,14,68,20],[90,18,68,20,"nextTick"],[90,39,68,28],[90,41,68,29],[90,47,68,35],[91,16,69,24,"_this"],[91,21,69,28],[91,22,69,29,"writable"],[91,30,69,37],[91,33,69,40],[91,37,69,44],[92,16,70,24,"_this"],[92,21,70,28],[92,22,70,29,"emitReserved"],[92,34,70,41],[92,35,70,42],[92,42,70,49],[92,43,70,50],[93,14,71,20],[93,15,71,21],[93,17,71,23,"_this"],[93,22,71,27],[93,23,71,28,"setTimeoutFn"],[93,35,71,40],[93,36,71,41],[94,12,72,16],[95,10,73,12],[95,11,73,13],[95,12,73,14],[96,8,74,8],[96,9,74,9],[97,8,63,8],[97,13,63,13],[97,17,63,17,"i"],[97,18,63,18],[97,21,63,21],[97,22,63,22],[97,24,63,24,"i"],[97,25,63,25],[97,28,63,28,"packets"],[97,35,63,35],[97,36,63,36,"length"],[97,42,63,42],[97,44,63,44,"i"],[97,45,63,45],[97,47,63,47],[98,10,63,47,"_loop"],[98,15,63,47],[99,8,63,47],[100,6,75,4],[101,4,75,5],[102,6,75,5,"key"],[102,9,75,5],[103,6,75,5,"value"],[103,11,75,5],[103,13,76,4],[103,22,76,4,"doClose"],[103,29,76,11,"doClose"],[103,30,76,11],[103,32,76,14],[104,8,77,8],[104,12,77,12,"_a"],[104,14,77,14],[105,8,78,8],[105,9,78,9,"_a"],[105,11,78,11],[105,14,78,14],[105,18,78,18],[105,19,78,19,"_transport"],[105,29,78,29],[105,35,78,35],[105,39,78,39],[105,43,78,43,"_a"],[105,45,78,45],[105,50,78,50],[105,55,78,55],[105,56,78,56],[105,59,78,59],[105,64,78,64],[105,65,78,65],[105,68,78,68,"_a"],[105,70,78,70],[105,71,78,71,"close"],[105,76,78,76],[105,77,78,77],[105,78,78,78],[106,6,79,4],[107,4,79,5],[108,2,79,5],[108,4,12,24,"Transport"],[108,24,12,33],[109,0,12,33],[109,3]],"functionMap":{"names":["<global>","WT","WT#get__name","WT#doOpen","_transport.closed.then$argument_0","_transport.closed.then._catch$argument_0","_transport.ready.then$argument_0","_transport.createBidirectionalStream.then$argument_0","read","reader.read.then$argument_0","reader.read.then._catch$argument_0","_writer.write.then$argument_0","WT#write","nextTick$argument_0","WT#doClose"],"mappings":"AAA;OCW;ICC;KDE;IEC;kBCS;SDE;mBEC;SFE;mCGE;6DCC;6BCM;8BCG;qBDM;+BEC;qBFC;iBDC;gDIM,mBJ;aDC;SHC;KFC;IWC;4CDK;6BEE;qBFG;aCE;KXE;IaC;KbG;CDC"}},"type":"js/module"}]}